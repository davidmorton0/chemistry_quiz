<% provide(:title, 'Quiz') %>

<div id="container">
  <div class="inner">
    <h1><%= @quiz_type.name %></h1>
    <%  unanswered = @quiz.questions.select { |question| question.answered == false } %>
    <%  number_questions = @quiz.questions.count %>
      
    <p class="score">
      <strong>
        <%= unanswered.length == 0 ? "You scored: #{@quiz.score}/#{number_questions}" : "Current Score: #{@quiz.score}" %>
      </strong>
    </p>
  
    <div id="startagain">
      <%= link_to "Start again", quizzes_path, method: "post", class: "btn btn-lg btn-primary" %>
    </div>
  </div>
  
  <div id="inner">
    <%= form_with model: @quiz, method: "patch", html: {class: "question"} do |f| %>
      <% @quiz.questions.each_with_index do |question, index| %>
        <div id="question">
          <p>
            <strong><%= index + 1 %>. <%= question.prompt %></strong>
          </p>
            
          <% question.answers.each do |answer| %>
            <div class="radio">
              <%= f.radio_button question.id, answer.text, options = {checked: answer.text == question.chosen_answer, disabled: question.answered}  %>
              <%= answer.text %>
              <%= if question.answered && (answer.text == question.chosen_answer || answer.text == question.correct_answer)
                    answer.text == question.correct_answer ? '✔️' : '❌'
              end %>
            </div>
          <% end %>
          <%= f.button "Answer", disabled: question.answered, name: "submit", value: question.id %>
        </div>
      <% end %>
      <br>
      <%= f.button "Answer All", name: "submit", value: "all" %>
    <% end %>
  </div>
</div>